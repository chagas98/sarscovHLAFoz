rank_values_refseq >= 2 ~ 'NB',
TRUE ~ 'NA'
)
) %>%
dplyr::mutate(
alleles = gsub(".binder_refseq|.binder", "", alleles),
alleles = gsub("HLA.B.", "B*", alleles),
alleles = gsub("\\.", ":", alleles),
impact = case_when(
grepl("NB", rank_refseq) & grepl("SB", rank_mutant) ~ 'Gain',
grepl("SB", rank_refseq) & grepl("NB", rank_mutant) ~ 'Loss',
grepl("NB", rank_refseq) & grepl("WB", rank_mutant) ~ 'Weak Gain',
grepl("SB", rank_refseq) & grepl("WB", rank_mutant) ~ 'Weak Loss',
TRUE ~ 'No Effect')
)
impact_dataset_deduplicate <- impact_dataset_all %>%
deduplicating(data = .,
columns = c("sequence", "length",
"pos", "gene", "alleles"))
impact_dataset_gain  <- impact_dataset_deduplicate %>%
#dplyr::filter(
#  if_any(contains("impact"), ~ . != 'No Effect'))
dplyr::filter(grepl('Gain', impact))
impact_dataset_loss  <- impact_dataset_deduplicate %>%
#dplyr::filter(
#  if_any(contains("impact"), ~ . != 'No Effect'))
dplyr::filter(grepl('Loss', impact))
impact_dataset_noeffect  <- impact_dataset_deduplicate %>%
#dplyr::filter(
#  if_any(contains("impact"), ~ . != 'No Effect'))
dplyr::filter(grepl('No Effect', impact))
alleles_names  <- unique(impact_dataset_deduplicate$alleles)
alleles_sorted  <- str_sort(alleles_names, numeric = TRUE)
genes_names  <- unique(impact_dataset_deduplicate$gene)
genes_sorted  <- genes_names[order(nchar(genes_names))]
impact_dataset_all$fold_change <- log2(impact_dataset_all$rank_values_mutant / impact_dataset_all$rank_values_refseq)
FC_loss_all <- impact_dataset_all %>%
dplyr::mutate(fold_change = log2(rank_values_mutant / rank_values_refseq)) %>%
dplyr::filter(impact %in% c('Loss', 'Weak Loss'))
library(ggnewscale)
cbp1 <- c("#ff0000", "#fd8282", "#ff7301", "#e2a807", "#f3d83f", "#206916", "#138f03",
"#0dad70", "#2464c4", "#4f90f1", "#00ccff", "#7c0494", "#e900ca", "#ee70ddc2")
library(grid)
muh_grob <- grid::rectGrob(
x=0, y=1:21, gp=gpar(
color='white', fill= getPalette_variants(colourCount_variants), alpha=0.8))
colourCount_alleles = length(unique(FC_loss_all$alleles))
getPalette_variants = colorRampPalette(brewer.pal(9, "Set1"))
test <- ggplot(lineage_date, aes(x = lubridate::my(month_year), y = prop, fill = factor(Lineage, detection_sorted))) +
geom_bar(stat = "identity",  colour="black") +
#scale_fill_manual(values = c("A" = "blue", "B" = "red", "C" = "green")) +  # Change colors as needed
labs( x = "Month-Year",
y = "Relative Prevalence (%)") +
scale_fill_manual(values = getPalette_variants(colourCount_variants))+
scale_x_date(date_breaks = '1 month', date_labels = "%b-%Y", expand = c(0.01,0)) +
scale_y_continuous(expand = c(0.01,0)) +
theme_classic() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
axis.line.x = element_blank(),
legend.title = element_blank(),
panel.grid=element_blank(),
panel.background=element_blank())
###################################################################################
################################### FIG 5 #########################################
###################################################################################
library(lubridate)
metadata <- read.csv('results/mutations/metadata_info.csv', sep=',')
patients <- read.csv('results/raw_data/patients_hla.csv', sep=',')
metadata_date <- metadata %>%
group_by(Date) %>%
mutate(month_year = format(as.Date(Date), "%m-%Y"),
year = format(as.Date(Date), "%Y"),
group_date = cur_group_id()
) %>%
ungroup()
detection_sorted  <- metadata_date %>%
group_by(Lineage) %>%
slice(which.min(group_date)) %>%
select(Lineage, first_detection = group_date) %>%
arrange(first_detection) %>%
pull(Lineage)
detection_sorted
lineage_date <- metadata_date %>%
count(Lineage, month_year) %>%
group_by(month_year) %>%
mutate(prop = prop.table(n)*100)
alleles_binned <- patients %>%
filter(HospitalPeriod_days < 65)  %>%
mutate(month_year = format(as.Date(Hospital_admission), "%m-%Y")) %>%
select(allele1, allele2, month_year) %>%
pivot_longer(cols = c(allele1, allele2),
names_to = 'type',
values_to = 'alleles') %>%
count(alleles) %>%
group_by(alleles) %>%
mutate(alleles = ifelse(n < 7, "Others", alleles)) %>%
ungroup()
patients_date <- patients %>%
filter(HospitalPeriod_days < 65) %>%
mutate(month_year = format(as.Date(Hospital_admission), "%m-%Y")) %>%
select(allele1, allele2, month_year) %>%
pivot_longer(cols = c(allele1, allele2),
names_to = 'type',
values_to = 'alleles') %>%
mutate(alleles = ifelse(alleles %in% alleles_binned$alleles, alleles, "Others")) %>%
count(alleles, month_year) %>%
group_by(month_year) %>%
mutate(prop = prop.table(n))
library(viridis)
colourCount_variants = length(unique(lineage_date$Lineage))
getPalette_variants = colorRampPalette(brewer.pal(9, "Set1"))
magma_edit <- c("#000004FF", "#302e57", "#4f4c85", "#7612b9", "#9d12b9" , "#b464c4",
"#d6147f", "#e77e83", "#ffc7c7", "#94011a",  "#ce1f3c", "#e24c54", "#e03a07", "#ff8800", "#fbb861", "#FECE91FF", "#FDE6A8FF", "#c29e00", "#eeca2a", "#e9de40",
"#c9c9c9")
test <- ggplot(lineage_date, aes(x = lubridate::my(month_year), y = prop, fill = factor(Lineage, detection_sorted))) +
geom_bar(stat = "identity",  colour="black") +
#scale_fill_manual(values = c("A" = "blue", "B" = "red", "C" = "green")) +  # Change colors as needed
labs( x = "Month-Year",
y = "Relative Prevalence (%)") +
scale_fill_manual(values = getPalette_variants(colourCount_variants))+
scale_x_date(date_breaks = '1 month', date_labels = "%b-%Y", expand = c(0.01,0)) +
scale_y_continuous(expand = c(0.01,0)) +
theme_classic() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
axis.line.x = element_blank(),
legend.title = element_blank(),
panel.grid=element_blank(),
panel.background=element_blank())
test1 <- ggplot(lineage_date, aes(x = lubridate::my(month_year), y = n)) +
geom_bar(stat = "identity") +
labs(x = "", y = "") +
scale_x_date(date_breaks = '1 month', date_labels = "%b-%Y", expand = c(0.01,0)) +
theme_linedraw() +
theme(axis.text.x = element_blank(),
axis.ticks.x = element_blank(),
plot.margin = margin(0, 0, 0, 0, "mm"))
(test1 + test + plot_layout(ncol=1, heights = c(1, 4), guides = "collect"))
(test1 + test + plot_layout(ncol=1, heights = c(0.5, 3), guides = "collect"))
(test1 + test + plot_layout(ncol=1, heights = c(0.1, 3), guides = "collect"))
(test1 + test + plot_layout(ncol=1, heights = c(0.3, 3), guides = "collect"))
(test1 + test + plot_layout(ncol=1, heights = c(0.5, 3), guides = "collect"))
colourCount_alleles = length(unique(patients_date$alleles))
getPalette_alleles = colorRampPalette(brewer.pal(9, "Spectral"))
ggplot(patients_date, aes(x = lubridate::my(month_year), y = prop, fill=alleles)) +
geom_bar(stat = "identity") +
#scale_fill_manual(values = c("A" = "blue", "B" = "red", "C" = "green")) +  # Change colors as needed
labs(title = "Relative Prevalence of Virus Lineages",
x = "Month-Year",
y = "Relative Prevalence (%)") +
scale_fill_manual(values = getPalette_alleles(colourCount_alleles))+
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_x_date(date_breaks = '1 month', date_labels = "%b-%Y")
ggplot(lineage_date, aes(x = lubridate::my(month_year))) +
geom_bar(stat = "count") +
#scale_fill_manual(values = c("A" = "blue", "B" = "red", "C" = "green")) +  # Change colors as needed
labs(title = "Relative Prevalence of Virus Lineages",
x = "Month-Year",
y = "Relative Prevalence (%)",
fill = "Lineage Name") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_x_date(date_breaks = '1 month', date_labels = "%b-%Y")
(test1 + test + plot_layout(ncol=1, heights = c(0.5, 3), guides = "collect"))
ggplot(patients_date, aes(x = lubridate::my(month_year), y = prop, fill=alleles)) +
geom_bar(stat = "identity") +
#scale_fill_manual(values = c("A" = "blue", "B" = "red", "C" = "green")) +  # Change colors as needed
labs(title = "Relative Prevalence of Virus Lineages",
x = "Month-Year",
y = "Relative Prevalence (%)") +
scale_fill_manual(values = getPalette_alleles(colourCount_alleles))+
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_x_date(date_breaks = '1 month', date_labels = "%b-%Y")
ggplot(patient_date, aes(x = lubridate::my(month_year))) +
geom_bar(stat = "identity") +
labs(x = "", y = "") +
scale_x_date(date_breaks = '1 month', date_labels = "%b-%Y", expand = c(0.01,0)) +
theme_linedraw() +
theme(axis.text.x = element_blank(),
axis.ticks.x = element_blank(),
plot.margin = margin(0, 0, 0, 0, "mm"))
ggplot(patients_date, aes(x = lubridate::my(month_year))) +
geom_bar(stat = "identity") +
labs(x = "", y = "") +
scale_x_date(date_breaks = '1 month', date_labels = "%b-%Y", expand = c(0.01,0)) +
theme_linedraw() +
theme(axis.text.x = element_blank(),
axis.ticks.x = element_blank(),
plot.margin = margin(0, 0, 0, 0, "mm"))
ggplot(patients_date, aes(x = lubridate::my(month_year),  y = n)) +
geom_bar(stat = "identity") +
labs(x = "", y = "") +
scale_x_date(date_breaks = '1 month', date_labels = "%b-%Y", expand = c(0.01,0)) +
theme_linedraw() +
theme(axis.text.x = element_blank(),
axis.ticks.x = element_blank(),
plot.margin = margin(0, 0, 0, 0, "mm"))
test2 <- ggplot(patients_date, aes(x = lubridate::my(month_year), y = prop, fill=alleles)) +
geom_bar(stat = "identity") +
#scale_fill_manual(values = c("A" = "blue", "B" = "red", "C" = "green")) +  # Change colors as needed
labs(title = "Relative Prevalence of Virus Lineages",
x = "Month-Year",
y = "Relative Prevalence (%)") +
scale_fill_manual(values = getPalette_alleles(colourCount_alleles))+
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_x_date(date_breaks = '1 month', date_labels = "%b-%Y")
test3 <- ggplot(patients_date, aes(x = lubridate::my(month_year),  y = n)) +
geom_bar(stat = "identity") +
labs(x = "", y = "") +
scale_x_date(date_breaks = '1 month', date_labels = "%b-%Y", expand = c(0.01,0)) +
theme_linedraw() +
theme(axis.text.x = element_blank(),
axis.ticks.x = element_blank(),
plot.margin = margin(0, 0, 0, 0, "mm"))
(test2 + test3 + plot_layout(ncol=1, heights = c(0.5, 3), guides = "collect"))
(test3 + test2 + plot_layout(ncol=1, heights = c(0.5, 3), guides = "collect"))
test2 <- ggplot(patients_date, aes(x = lubridate::my(month_year), y = prop, fill=alleles)) +
geom_bar(stat = "identity") +
#scale_fill_manual(values = c("A" = "blue", "B" = "red", "C" = "green")) +  # Change colors as needed
labs(title = "Relative Prevalence of Virus Lineages",
x = "Month-Year",
y = "Relative Prevalence (%)") +
scale_fill_manual(values = getPalette_alleles(colourCount_alleles))+
scale_x_date(date_breaks = '1 month', date_labels = "%b-%Y", expand = c(0.01,0)) +
scale_y_continuous(expand = c(0.01,0)) +
theme_classic() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
axis.line.x = element_blank(),
legend.title = element_blank(),
panel.grid=element_blank(),
panel.background=element_blank())
test3 <- ggplot(patients_date, aes(x = lubridate::my(month_year),  y = n)) +
geom_bar(stat = "identity") +
labs(x = "", y = "") +
scale_x_date(date_breaks = '1 month', date_labels = "%b-%Y", expand = c(0.01,0)) +
theme_linedraw() +
theme(axis.text.x = element_blank(),
axis.ticks.x = element_blank(),
plot.margin = margin(0, 0, 0, 0, "mm"))
(test3 + test2 + plot_layout(ncol=1, heights = c(0.5, 3), guides = "collect"))
(test1 + test + plot_layout(ncol=1, heights = c(0.5, 3), guides = "collect"))
(test3 + test2 + plot_layout(ncol=1, heights = c(0.5, 3), guides = "collect"))
test2 <- ggplot(patients_date, aes(x = lubridate::my(month_year), y = prop, fill=alleles)) +
geom_bar(stat = "identity") +
#scale_fill_manual(values = c("A" = "blue", "B" = "red", "C" = "green")) +  # Change colors as needed
labs(x = "Month-Year",
y = "Relative Prevalence (%)") +
scale_fill_manual(values = getPalette_alleles(colourCount_alleles))+
scale_x_date(date_breaks = '1 month', date_labels = "%b-%Y", expand = c(0.01,0)) +
scale_y_continuous(expand = c(0.01,0)) +
theme_classic() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
axis.line.x = element_blank(),
legend.title = element_blank(),
panel.grid=element_blank(),
panel.background=element_blank())
test3 <- ggplot(patients_date, aes(x = lubridate::my(month_year),  y = n)) +
geom_bar(stat = "identity") +
labs(x = "", y = "") +
scale_x_date(date_breaks = '1 month', date_labels = "%b-%Y", expand = c(0.01,0)) +
theme_linedraw() +
theme(axis.text.x = element_blank(),
axis.ticks.x = element_blank(),
plot.margin = margin(0, 0, 0, 0, "mm"))
(test3 + test2 + plot_layout(ncol=1, heights = c(0.5, 3), guides = "collect"))
(test1 + test + plot_layout(ncol=1, heights = c(0.5, 3), guides = "collect"))
test2 <- ggplot(patients_date, aes(x = factor(lubridate::my(month_year), lubridate::my(unique(lineage_date$month_year)), y = prop, fill=alleles)) +
test2 <- ggplot(patients_date, aes(x = factor(lubridate::my(month_year), lubridate::my(unique(lineage_date$month_year))), y = prop, fill=alleles)) +
geom_bar(stat = "identity", colour="black") +
#scale_fill_manual(values = c("A" = "blue", "B" = "red", "C" = "green")) +  # Change colors as needed
labs(x = "Month-Year",
y = "Relative Prevalence (%)") +
scale_fill_manual(values = getPalette_alleles(colourCount_alleles))+
scale_x_date(date_breaks = '1 month', date_labels = "%b-%Y", expand = c(0.01,0)) +
scale_y_continuous(expand = c(0.01,0)) +
theme_classic() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
axis.line.x = element_blank(),
legend.title = element_blank(),
panel.grid=element_blank(),
panel.background=element_blank())
test3 <- ggplot(patients_date, aes(x = lubridate::my(month_year),  y = n)) +
test2 <- ggplot(patients_date, aes(x = factor(lubridate::my(month_year), lubridate::my(unique(lineage_date$month_year))), y = prop, fill=alleles)) +
geom_bar(stat = "identity", colour="black") +
#scale_fill_manual(values = c("A" = "blue", "B" = "red", "C" = "green")) +  # Change colors as needed
labs(x = "Month-Year",
y = "Relative Prevalence (%)") +
scale_fill_manual(values = getPalette_alleles(colourCount_alleles))+
scale_x_date(date_breaks = '1 month', date_labels = "%b-%Y", expand = c(0.01,0)) +
scale_y_continuous(expand = c(0.01,0)) +
theme_classic() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
axis.line.x = element_blank(),
legend.title = element_blank(),
panel.grid=element_blank(),
panel.background=element_blank())
test3 <- ggplot(patients_date, aes(x = lubridate::my(month_year),  y = n)) +
geom_bar(stat = "identity") +
labs(x = "", y = "") +
scale_x_date(date_breaks = '1 month', date_labels = "%b-%Y", expand = c(0.01,0)) +
theme_linedraw() +
theme(axis.text.x = element_blank(),
axis.ticks.x = element_blank(),
plot.margin = margin(0, 0, 0, 0, "mm"))
(test3 + test2 + plot_layout(ncol=1, heights = c(0.5, 3), guides = "collect"))
lubridate::my(unique(lineage_date$month_year))
factor(lubridate::my(unique(lineage_date$month_year)))
factor(lubridate::my(month_year), lubridate::my(unique(lineage_date$month_year)))
factor(lubridate::my(patients_date$month_year), lubridate::my(unique(lineage_date$month_year)))
factor(lubridate::my(patients_date$month_year), lubridate::my(unique(lineage_date$month_year)))
test2 <- ggplot(patients_date, aes(x = factor(lubridate::my(month_year), lubridate::my(unique(lineage_date$month_year))), y = prop, fill=alleles)) +
geom_bar(stat = "identity", colour="black") +
#scale_fill_manual(values = c("A" = "blue", "B" = "red", "C" = "green")) +  # Change colors as needed
labs(x = "Month-Year",
y = "Relative Prevalence (%)") +
scale_fill_manual(values = getPalette_alleles(colourCount_alleles))+
scale_x_date(date_breaks = '1 month', date_labels = "%b-%Y", expand = c(0.01,0)) +
scale_y_continuous(expand = c(0.01,0)) +
theme_classic() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
axis.line.x = element_blank(),
legend.title = element_blank(),
panel.grid=element_blank(),
panel.background=element_blank())
test2
factor(lubridate::my(patients_date$month_year), as.Date(lubridate::my(unique(lineage_date$month_year))))
test2 <- ggplot(patients_date, aes(x = factor(lubridate::my(patients_date$month_year), as.Date(lubridate::my(unique(lineage_date$month_year)))), y = prop, fill=alleles)) +
geom_bar(stat = "identity", colour="black") +
#scale_fill_manual(values = c("A" = "blue", "B" = "red", "C" = "green")) +  # Change colors as needed
labs(x = "Month-Year",
y = "Relative Prevalence (%)") +
scale_fill_manual(values = getPalette_alleles(colourCount_alleles))+
scale_x_date(date_breaks = '1 month', date_labels = "%b-%Y", expand = c(0.01,0)) +
scale_y_continuous(expand = c(0.01,0)) +
theme_classic() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
axis.line.x = element_blank(),
legend.title = element_blank(),
panel.grid=element_blank(),
panel.background=element_blank())
test2
test2 <- ggplot(patients_date, aes(x = factor(as.Date(lubridate::my(patients_date$month_year)), as.Date(lubridate::my(unique(lineage_date$month_year)))), y = prop, fill=alleles)) +
geom_bar(stat = "identity", colour="black") +
#scale_fill_manual(values = c("A" = "blue", "B" = "red", "C" = "green")) +  # Change colors as needed
labs(x = "Month-Year",
y = "Relative Prevalence (%)") +
scale_fill_manual(values = getPalette_alleles(colourCount_alleles))+
scale_x_date(date_breaks = '1 month', date_labels = "%b-%Y", expand = c(0.01,0)) +
scale_y_continuous(expand = c(0.01,0)) +
theme_classic() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
axis.line.x = element_blank(),
legend.title = element_blank(),
panel.grid=element_blank(),
panel.background=element_blank())
test2
test2 <- ggplot(patients_date, aes(x = factor(lubridate::my(as.Date(patients_date$month_year))), lubridate::my(as.Date(unique(lineage_date$month_year))))), y = prop, fill=alleles)) +
test2 <- ggplot(patients_date, aes(x = factor(lubridate::my(as.Date(patients_date$month_year))), lubridate::my(as.Date(unique(lineage_date$month_year)))), y = prop, fill=alleles)) +
test2 <- ggplot(patients_date, aes(x = factor(lubridate::my(as.Date(patients_date$month_year))), lubridate::my(as.Date(unique(lineage_date$month_year))), y = prop, fill=alleles)) +
geom_bar(stat = "identity", colour="black") +
#scale_fill_manual(values = c("A" = "blue", "B" = "red", "C" = "green")) +  # Change colors as needed
labs(x = "Month-Year",
y = "Relative Prevalence (%)") +
scale_fill_manual(values = getPalette_alleles(colourCount_alleles))+
scale_x_date(date_breaks = '1 month', date_labels = "%b-%Y", expand = c(0.01,0)) +
scale_y_continuous(expand = c(0.01,0)) +
theme_classic() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
axis.line.x = element_blank(),
legend.title = element_blank(),
panel.grid=element_blank(),
panel.background=element_blank())
test2
test2 <- ggplot(patients_date, aes(x = factor(lubridate::my(as.Date(patients_date$month_year),"%Y-%m-%d")), lubridate::my(as.Date(unique(lineage_date$month_year),"%Y-%m-%d")), y = prop, fill=alleles)) +
geom_bar(stat = "identity", colour="black") +
#scale_fill_manual(values = c("A" = "blue", "B" = "red", "C" = "green")) +  # Change colors as needed
labs(x = "Month-Year",
y = "Relative Prevalence (%)") +
scale_fill_manual(values = getPalette_alleles(colourCount_alleles))+
scale_x_date(date_breaks = '1 month', date_labels = "%b-%Y", expand = c(0.01,0)) +
scale_y_continuous(expand = c(0.01,0)) +
theme_classic() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
axis.line.x = element_blank(),
legend.title = element_blank(),
panel.grid=element_blank(),
panel.background=element_blank())
test2
test2 <- ggplot(patients_date, aes(x = lubridate::my(month_year), y = prop, fill=alleles)) +
geom_bar(stat = "identity", colour="black") +
#scale_fill_manual(values = c("A" = "blue", "B" = "red", "C" = "green")) +  # Change colors as needed
labs(x = "Month-Year",
y = "Relative Prevalence (%)") +
scale_fill_manual(values = getPalette_alleles(colourCount_alleles))+
scale_x_date(date_breaks = '1 month', date_labels = "%b-%Y", expand = c(0.01,0)) +
scale_y_continuous(expand = c(0.01,0)) +
theme_classic() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
axis.line.x = element_blank(),
legend.title = element_blank(),
panel.grid=element_blank(),
panel.background=element_blank())
test3 <- ggplot(patients_date, aes(x = lubridate::my(month_year),  y = n)) +
geom_bar(stat = "identity") +
labs(x = "", y = "") +
scale_x_date(date_breaks = '1 month', date_labels = "%b-%Y", expand = c(0.01,0)) +
theme_linedraw() +
theme(axis.text.x = element_blank(),
axis.ticks.x = element_blank(),
plot.margin = margin(0, 0, 0, 0, "mm"))
test2
test2 <- ggplot(patients_date, aes(x = lubridate::my(lineage_date$month_year), y = prop, fill=alleles)) +
geom_bar(stat = "identity", colour="black") +
#scale_fill_manual(values = c("A" = "blue", "B" = "red", "C" = "green")) +  # Change colors as needed
labs(x = "Month-Year",
y = "Relative Prevalence (%)") +
scale_fill_manual(values = getPalette_alleles(colourCount_alleles))+
scale_x_date(date_breaks = '1 month', date_labels = "%b-%Y", expand = c(0.01,0)) +
scale_y_continuous(expand = c(0.01,0)) +
theme_classic() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
axis.line.x = element_blank(),
legend.title = element_blank(),
panel.grid=element_blank(),
panel.background=element_blank())
test2
test2 <- ggplot(patients_date, aes(x = lubridate::my(month_year), y = prop, fill=alleles)) +
geom_bar(stat = "identity", colour="black") +
#scale_fill_manual(values = c("A" = "blue", "B" = "red", "C" = "green")) +  # Change colors as needed
labs(x = "Month-Year",
y = "Relative Prevalence (%)") +
scale_fill_manual(values = getPalette_alleles(colourCount_alleles))+
scale_x_date(date_breaks = '1 month', date_labels = "%b-%Y", expand = c(0.01,0)) +
scale_y_continuous(expand = c(0.01,0)) +
theme_classic() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
axis.line.x = element_blank(),
legend.title = element_blank(),
panel.grid=element_blank(),
panel.background=element_blank()) +
scale_x_date(limits = min(lineage_date$month_year), max(lineage_date$month_year))
test2 <- ggplot(patients_date, aes(x = lubridate::my(month_year), y = prop, fill=alleles)) +
geom_bar(stat = "identity", colour="black") +
#scale_fill_manual(values = c("A" = "blue", "B" = "red", "C" = "green")) +  # Change colors as needed
labs(x = "Month-Year",
y = "Relative Prevalence (%)") +
scale_fill_manual(values = getPalette_alleles(colourCount_alleles))+
scale_x_date(date_breaks = '1 month', date_labels = "%b-%Y", expand = c(0.01,0)) +
scale_y_continuous(expand = c(0.01,0)) +
theme_classic() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
axis.line.x = element_blank(),
legend.title = element_blank(),
panel.grid=element_blank(),
panel.background=element_blank()) #+
test2
scale_x_date(limits = min(as.Date(lineage_date$month_year)), max(as.Date(lineage_date$month_year)))
scale_x_date(limits = min(my(lineage_date$month_year)), max(amy(lineage_date$month_year)))
scale_x_date(limits = min(my(lineage_date$month_year)), max(my(lineage_date$month_year)))
scale_x_date(limits = min(lubridate::my(lineage_date$month_year)), max(lubridate::my(lineage_date$month_year)))
min(lubridate::my(lineage_date$month_year))
test2
test2 <- ggplot(patients_date, aes(x = lubridate::my(month_year), y = prop, fill=alleles)) +
geom_bar(stat = "identity", colour="black") +
#scale_fill_manual(values = c("A" = "blue", "B" = "red", "C" = "green")) +  # Change colors as needed
labs(x = "Month-Year",
y = "Relative Prevalence (%)") +
scale_fill_manual(values = getPalette_alleles(colourCount_alleles))+
#scale_x_date(date_breaks = '1 month', date_labels = "%b-%Y", expand = c(0.01,0)) +
scale_y_continuous(expand = c(0.01,0)) +
theme_classic() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
axis.line.x = element_blank(),
legend.title = element_blank(),
panel.grid=element_blank(),
panel.background=element_blank()) #+
scale_x_date(limits = min(lubridate::my(lineage_date$month_year)), max(lubridate::my(lineage_date$month_year)))
test2
scale_x_date(date_breaks = '1 month', date_labels = "%b-%Y", expand = c(0.01,0), limits = min(lubridate::my(lineage_date$month_year)), max(lubridate::my(lineage_date$month_year)))
test2
test2 <- ggplot(patients_date, aes(x = lubridate::my(month_year), y = prop, fill=alleles)) +
geom_bar(stat = "identity", colour="black") +
#scale_fill_manual(values = c("A" = "blue", "B" = "red", "C" = "green")) +  # Change colors as needed
labs(x = "Month-Year",
y = "Relative Prevalence (%)") +
scale_fill_manual(values = getPalette_alleles(colourCount_alleles))+
#scale_x_date(date_breaks = '1 month', date_labels = "%b-%Y", expand = c(0.01,0)) +
scale_y_continuous(expand = c(0.01,0)) +
theme_classic() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
axis.line.x = element_blank(),
legend.title = element_blank(),
panel.grid=element_blank(),
panel.background=element_blank()) +
scale_x_date(date_breaks = '1 month', date_labels = "%b-%Y", expand = c(0.01,0), limits = min(lubridate::my(lineage_date$month_year)), max(lubridate::my(lineage_date$month_year)))
test2
test2 <- ggplot(patients_date, aes(x = lubridate::my(month_year), y = prop, fill=alleles)) +
geom_bar(stat = "identity", colour="black") +
#scale_fill_manual(values = c("A" = "blue", "B" = "red", "C" = "green")) +  # Change colors as needed
labs(x = "Month-Year",
y = "Relative Prevalence (%)") +
scale_fill_manual(values = getPalette_alleles(colourCount_alleles))+
#scale_x_date(date_breaks = '1 month', date_labels = "%b-%Y", expand = c(0.01,0)) +
scale_y_continuous(expand = c(0.01,0)) +
theme_classic() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
axis.line.x = element_blank(),
legend.title = element_blank(),
panel.grid=element_blank(),
panel.background=element_blank()) +
scale_x_date(limits = min(lubridate::my(lineage_date$month_year)), max(lubridate::my(lineage_date$month_year)))
test2
min(lubridate::my(lineage_date$month_year))
max(lubridate::my(lineage_date$month_year))
